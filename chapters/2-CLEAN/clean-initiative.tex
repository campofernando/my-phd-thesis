% ----------------------------------------------------------
\chapter{CLEAN - Collaborative Low-cost Environmental and Air-quality Network}\label{cap:clean-initiative}
% ----------------------------------------------------------

A iniciativa CLEAN\footnotemark[3] consiste numa plataforma colaborativa de código aberto para promover e facilitar o desenvolvimento de monitores de qualidade do ar de baixo custo e o acesso remoto a informações sobre a qualidade do ar em tempo real. Possui três componentes principais, conforme enumerado a seguir e ilustrado de forma gráfica na Figura \ref{fig:clean-structure}.
\footnotetext[3]{O conteúdo deste capítulo foi publicado em artigo científico na revista Environmental Modelling \& Software \cite{Campo2021} e possui registro de programa de computador no Instituto Nacional de Propriedade Industrial com número BR512022001116-6}

\begin{enumerate}
    \item API Renovar para acesso aos dados de dispositivos de monitoramento
    \item Bibliotecas de \textit{firmware} baseadas no framework Arduino para programação dos dispositivos de monitoramento e comunicação com a \textit{api}
    \item Aplicação \textit{web} \href{http://renovar.lcqar.ufsc.br/}{Renovar} para visualização e análise dos dados na forma de mapas, séries históricas e gráficos de \textit{box-plot}
\end{enumerate}

\begin{figure}[h]
    \centering
    \caption{Componentes da iniciativa CLEAN}
    \includegraphics[width=0.80\linewidth]{chapters//2-CLEAN//Figuras/Estrutura CLEAN.png}
    \label{fig:clean-structure}
    \fonte{Desenvolvido pelo autor (2023)}
\end{figure}

Além disso, a iniciativa disponibiliza a documentação do \textit{hardware} e do \textit{firmware} dos monitores desenvolvidos dentro desse contexto para facilitar a sua replicação e a colaboração entre os diferentes agentes. Todos os guias e documentação relativos ao desenvolvimento do hardware e firmware dos dispositivos até agora concebidos, as bibliotecas implementadas e as ferramentas de desenvolvimento estão abertas e disponíveis gratuitamente na página inicial de CLEAN \cite{Campo2021}.

A \acrshort{api} Renovar disponibiliza os recursos necessários para a comunicação remota com dispositivos de monitoramento, o registro das leituras dos dispositivos e o acesso aos dados para visualização, processamento e análise. Dentro da iniciativa CLEAN pretende-se que a \acrshort{api} seja uma forma de centralizar o registro (através de dispositivos de monitoramento) e o acesso (através de aplicações cliente) a dados da qualidade do ar de monitores de baixo custo desenvolvidos por parceiros, eximindo eles da necessidade de desenvolver soluções próprias desde zero. Assim, CLEAN pretende acelerar e facilitar a expansão de aplicações de monitoramento de baixo custo e de análise de dados. 

As bibliotecas de \textit{firmware} providenciam uma interface entre o \textit{hardware} e \textit{firmware} específico para cada aplicação de monitoramento e a \acrshort{api}, facilitando também o processo de desenvolvimento, e permitindo aos parceiros focarem na aplicação em si, sem investir muito esforço na integração com a \acrshort{api}. As bibliotecas de \textit{firmware} também providenciam abstrações para os componentes de \textit{hardware}, como sensores, controladores e periféricos, contribuindo ao reaproveitamento de código. A medida que os parceiros forem incorporando novos componentes nas suas aplicações, novas abstrações podem ser adicionadas às bibliotecas, expandindo o leque de interfaces a componentes de \textit{hardware}.

A aplicação \textit{web} Renovar desenvolvida dentro do contexto de CLEAN é uma aplicação \textit{front-end} consumidora da \acrshort{api}. Ela é uma alternativa para iniciar qualquer aplicação de monitoramento de baixo custo já que disponibiliza a visualização de mapas dos dispositivos, séries temporais dos dados dos sensores e gráficos de \textit{box-plots} dos dados. Pode funcionar também como modelo para outras aplicações consumidoras que venham a ser desenvolvidas.

A continuação são descritas as estruturas das bibliotecas de \textit{firmware}, da \textit{API} e os dispositivos de \textit{desenvolvidos}. Nos Apêndices \ref{appendix: firmware} e \ref{apendix:esp8266-fw} descrevem-se também os códigos gravados nos microcontroladores Arduino e ESP8266 dos equipamentos CLEAN.

\input{chapters/2-CLEAN/Seções/fw-libraries}

\input{chapters/2-CLEAN/Seções/renovar-api}

\section{Dispositivos de hardware desenvolvidos}

Dentro do contexto da iniciativa CLEAN foram desenvolvidos dispositivos para medição da qualidade do ar. Dois desses dispositivos foram protótipos para validação da ideia, concebidos para medições em locais fixos e medições móveis. Numa segunda etapa foram desenvolvidos dispositivos mais robustos com placas de circuito impresso e quadros elétricos para instalação em campo. A continuação serão descritos os equipamentos produzidos.

\subsection{Protótipos de monitores de qualidade do ar de baixo custo}

Foram concebidos dois protótipos de baixo custo para medição de poluentes atmosféricos \cite{Campo2020DEPLOYMENTRESULTS}, um para monitoramento fixo e outro para monitoramento móvel. O hardware de ambos os dispositivos, conforme mostrado na Figura \ref{fig:device-structure}, é composto por três blocos principais: 1) transporte de gás, 2) sensoriamento e 3) microcontrolador. O estágio de transporte de gás captura o ar ambiente nos sensores, que produzem um sinal analógico proporcional à concentração do gás. O microcontrolador, que é um Microchip ATMega2560 embarcado em uma plataforma Arduino Mega, captura as respostas dos sensores e as transforma em dados de concentração de gás. O hardware também obtém a hora e o local onde cada medição foi coletada. O microcontrolador armazena essas informações em um cartão micro SD e as transmite para um servidor web hospedado na Superintendência de Tecnologia da Informação e Comunicação da Universidade, rodando o aplicativo Renovar Web. Uma conexão Wi-Fi é estabelecida por um microcontrolador ESP8266 para transmissão de dados. Um relógio em tempo real e um módulo GPS fornecem informações de data, hora e geolocalização, respectivamente.

\begin{figure}
    \centering
    \caption{Estrutura principal dos dispositivos. a) Medidor de gases fixo, e b) medidor móvel}
    \includegraphics[width=1\linewidth]{chapters//2-CLEAN//Figuras/Estrutura geral protótipos.png}
    \label{fig:device-structure}
    \fonte{Desenvolvido pelo autor (2023)}
\end{figure}

A versão fixa dos dispositivos de monitoramento (Figura \ref{fig:device-structure}a) utiliza seis sensores eletroquímicos do fabricante de sensores Alphasense e quatro sensores eletroquímicos do fabricante SPEC Sensors. Para alimentação de energia do dispositivo utiliza-se uma fonte de 12VCC. Este dispositivo não incorpora módulo \textit{GPS} para geolocalização. A versão móvel (Figura \ref{fig:device-structure}b), por outro lado, utiliza apenas quatro sensores eletroquímicos do fabricante SPEC Sensors. O dispositivo é alimentado por um banco de energia de 5VCC através de uma conexão USB. A Figura 3 ilustra ambos protótipos na versão fixa e móvel. Mais detalhes sobre os dispositivos podem ser encontrados no Apêndice \ref{apendix: hw-prototypes}.

\begin{figure}
    \centering
    \caption{Ilustrações das versões (a) fixa e (b) móvel dos dispositivos de monitoramento}
    \includegraphics[width=1\linewidth]{chapters//2-CLEAN/Figuras/Monitoring Prototypes.jpg}
    \label{fig:monitoring-prototypes}
    \fonte{Desenvolvido pelo autor (2023)}
\end{figure}

\subsection{A placa CLEAN Arduino MEGA}

Com base nos resultados obtidos pelos protótipos e nas experiências alcançadas, foi desenvolvida uma versão mais compacta e atualizada para monitoramento fixo. Esta versão foi chamada de \textit{CLEAN Arduino Mega Board} por causa do microcontrolador Arduino Mega que ela usa como processador principal. A composição do hardware é muito semelhante à dos protótipos, mas os módulos foram montados em uma única \textit{PCB}. A Figura \ref{fig:clean-arduino-mega-board} ilustra o projeto da PCB e uma das placas fabricadas. A PCB foi criada no \textit{software} Eagle, e os arquivos do projeto estão disponíveis nos repositórios do LCQAr da UFSC.

\begin{figure}
    \centering
    \caption{A placa CLEAN Arduino Mega: (a) projeto PCB, (b) vista superior da placa, (c) vista inferior da placa.}
    \includegraphics[width=1\linewidth]{chapters//2-CLEAN/Figuras/CLEAN Arduino Mega Board.jpg}
    \label{fig:clean-arduino-mega-board}
    \fonte{Desenvolvido pelo autor (2023)}
\end{figure}

A Tabela \ref{tab:componentes-clean} do apêndice \ref{apendix: clean-arduino-mega-board} mostra os principais componentes de hardware utilizados na placa, que requer uma tensão de alimentação de 12V, 2A através de um conector de alimentação P4. Possui entradas analógicas para 6 placas de sensores Alphasense da série ISB, barramento RS-485 para futuras expansões, três saídas digitais e conectores para alimentação de ventoinhas de 12V e 5V. A placa foi concebida para suportar conexões Wi-Fi e \textit{GPRS} à Internet. Essas conexões não podem ser utilizadas simultaneamente, o que dependerá de cada aplicação. O usuário pode configurar a placa para usar um ou outro e terá que adaptar o firmware do microcontrolador Arduino correspondentemente.

